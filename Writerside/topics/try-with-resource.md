# try-with-resource êµ¬ë¬¸

### **`try-with-resources` êµ¬ë¬¸ì˜ ì¥ë‹¨ì ê³¼ í™œìš© ì‹œ ìœ ì˜ì **

`try-with-resources` êµ¬ë¬¸ì€ **ìì›ì´ ìë™ìœ¼ë¡œ ë‹«íˆë„ë¡ ë³´ì¥í•˜ëŠ”** Javaì˜ ê¸°ëŠ¥ìœ¼ë¡œ, `AutoCloseable` ë˜ëŠ” `Closeable` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## **âœ… ì¥ì **

### **ìì› í•´ì œë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬**
- `try` ë¸”ë¡ì´ ëë‚˜ë©´ `close()` ë©”ì„œë“œê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤.
- ê°œë°œìê°€ ì§ì ‘ `finally` ë¸”ë¡ì—ì„œ `close()`ë¥¼ í˜¸ì¶œí•  í•„ìš”ê°€ ì—†ì–´ ì½”ë“œê°€ ê°„ê²°í•´ì§‘ë‹ˆë‹¤.

### **ì˜ˆì™¸ ë°œìƒ ì‹œ ìì› ëˆ„ìˆ˜ ë°©ì§€**
- `finally` ë¸”ë¡ì—ì„œ `close()`ë¥¼ í˜¸ì¶œí•  ê²½ìš°, ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ìì›ì´ ë‹«íˆì§€ ì•Šì„ ìœ„í—˜ì´ ìˆì§€ë§Œ `try-with-resources`ëŠ” ì´ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.

### **ì½”ë“œ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ**
- `finally` ë¸”ë¡ ì—†ì´ë„ ì•ˆì „í•œ ìì› ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆì–´ ì½”ë“œê°€ ê¹”ë”í•´ì§‘ë‹ˆë‹¤.

### **ë©€í‹° ìºì¹˜ì™€ ê²°í•© ê°€ëŠ¥**
- `try-with-resources` ë‚´ë¶€ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ë¥¼ `catch` ë¸”ë¡ìœ¼ë¡œ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## **âš ï¸ ìœ ì˜í•´ì•¼ í•  ì **

### 1. **`AutoCloseable` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥**
- ì§ì ‘ ë§Œë“  í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ `AutoCloseable` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.
- ì˜ˆì‹œ:
  ```java
  class MyResource implements AutoCloseable {
      @Override
      public void close() {
          System.out.println("Resource closed");
      }
  }
  ```

### 2. **ìì› í•´ì œ ìˆœì„œì— ì£¼ì˜**
- ì—¬ëŸ¬ ê°œì˜ ìì›ì„ ì‚¬ìš©í•  ê²½ìš°, **ë°˜ëŒ€ë¡œ ë‹«í™ë‹ˆë‹¤** (LIFO ë°©ì‹).
  ```java
  try (ResourceA a = new ResourceA(); ResourceB b = new ResourceB()) {
      // ì‹¤í–‰ ì½”ë“œ
  }
  ```
    - ìœ„ ì½”ë“œì—ì„œëŠ” `b.close()`ê°€ ë¨¼ì € í˜¸ì¶œë˜ê³ , ê·¸ë‹¤ìŒ `a.close()`ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.

### 3. **ì¤‘ì²©ëœ `try` ë¸”ë¡ ì—†ì´ í•œ ë²ˆì— ì—¬ëŸ¬ ìì› ì²˜ë¦¬ ê°€ëŠ¥**
- ì˜ˆì „ì—ëŠ” `finally`ì—ì„œ ê° ìì›ì„ ë‹«ì•˜ì§€ë§Œ, `try-with-resources`ë¥¼ í™œìš©í•˜ë©´ **ì—¬ëŸ¬ ê°œì˜ ìì›ì„ í•œ ë²ˆì— ì„ ì–¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  ```java
  try (BufferedReader br = new BufferedReader(new FileReader("file.txt"));
       FileWriter fw = new FileWriter("output.txt")) {
      // ìì› ì‚¬ìš©
  }
  ```

### 4. **ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„± ê³ ë ¤**
- Java 7ë¶€í„° ì§€ì›ë˜ë¯€ë¡œ, ì´ì „ ë²„ì „(JDK 6 ì´í•˜)ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

---

## **ğŸ’¡ ì‹¤ìš©ì ì¸ í™œìš© ì˜ˆì‹œ**

### **1. íŒŒì¼ ì…ì¶œë ¥ ì‹œ í™œìš©**
```java
try (BufferedReader br = new BufferedReader(new FileReader("file.txt"))) {
    String line;
    while ((line = br.readLine()) != null) {
        System.out.println(line);
    }
} catch (IOException e) {
    e.printStackTrace();
}
```
- `BufferedReader`ê°€ ìë™ìœ¼ë¡œ ë‹«í˜€ **ìì› ëˆ„ìˆ˜ë¥¼ ë°©ì§€**í•©ë‹ˆë‹¤.

### **2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹œ í™œìš© (JDBC)**
```java
try (Connection conn = DriverManager.getConnection(url, user, password);
     PreparedStatement pstmt = conn.prepareStatement("SELECT * FROM users");
     ResultSet rs = pstmt.executeQuery()) {

    while (rs.next()) {
        System.out.println(rs.getString("name"));
    }
} catch (SQLException e) {
    e.printStackTrace();
}
```
- **`Connection`, `PreparedStatement`, `ResultSet`ì„ ì•ˆì „í•˜ê²Œ ë‹«ì•„** DB ì—°ê²° ë¬¸ì œë¥¼ ì˜ˆë°©í•©ë‹ˆë‹¤.

---

## **ğŸ” ì •ë¦¬**
| í•­ëª© | ì„¤ëª… |
|------|------|
| **ì¥ì ** | ìë™ ìì› í•´ì œ, ì˜ˆì™¸ ë°œìƒ ì‹œ ì•ˆì „í•œ ìì› ê´€ë¦¬, ê°€ë…ì„± í–¥ìƒ |
| **ë‹¨ì  ë° ìœ ì˜ì ** | `AutoCloseable` êµ¬í˜„ í•„ìš”, ìì› í•´ì œ ìˆœì„œ ì£¼ì˜, JDK 7 ì´ìƒ í•„ìš” |
| **ì£¼ìš” í™œìš© ì˜ˆì‹œ** | íŒŒì¼ ì…ì¶œë ¥, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, ë„¤íŠ¸ì›Œí¬ ìŠ¤íŠ¸ë¦¼ ê´€ë¦¬ |

---

### **ğŸ‘‰ ê²°ë¡ **
`try-with-resources`ëŠ” ìì›ì„ ë‹¤ë£° ë•Œ ë°œìƒí•˜ëŠ” **ìì› ëˆ„ìˆ˜ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê³ , ì½”ë“œì˜ ì•ˆì •ì„±ì„ ë†’ì´ëŠ” ì¤‘ìš”í•œ ê¸°ëŠ¥**ì…ë‹ˆë‹¤.  
íŠ¹íˆ **íŒŒì¼ ì²˜ë¦¬, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, ë„¤íŠ¸ì›Œí¬ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬** ë“±ì—ì„œ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ğŸš€

> **ìì›ê´€ë¦¬ê°€ ì¤‘ìš”í•œ ì´ìœ **
>
> * íŒŒì¼ ê¸°ìˆ ì(file descriptor), ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, ì†Œì¼“(socket)ê³¼ ê°™ì€ ìì›ì€ ìœ í•œí•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ìì›ì„ ë”ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì ì ˆíˆ ë°˜í™˜í•´ì•¼ í•©ë‹ˆë‹¤.
> * Java í”„ë¡œê·¸ë¨ì€ ì°¸ì¡°ë˜ì§€ ì•ŠëŠ” ë©”ëª¨ë¦¬ ìì›ì„ ìŠ¤ìŠ¤ë¡œ í•´ì œí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ íŒŒì¼ ê¸°ìˆ ì, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°, ì†Œì¼“ê³¼ ê°™ì€ ë¹„-ë©”ëª¨ë¦¬ ìì›ì€ ìŠ¤ìŠ¤ë¡œ í•´ì œí•˜ì§€ ì•Šê³  ê³„ì† ì ìœ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì•ì˜ ì˜ˆì œì²˜ëŸ¼ fisë¥¼ í•´ì œí•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ëŸ‰ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ì„œ ì²˜ë¦¬ê°€ ì¤‘ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> Too many open files
> ì´ì²˜ëŸ¼ ìì›ì„ ì˜¤ë˜ ì ìœ í•˜ë©´ ì²˜ë¦¬ ì„±ëŠ¥ì´ ì €í•˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì›ì„ ë”ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìµœëŒ€í•œ ë¹¨ë¦¬ í•´ì œí•˜ì‹­ì‹œì˜¤. ì•ì˜ ì˜ˆì œì˜ ê²½ìš°, loadFile ë©”ì„œë“œ ì´í›„ë¡œ fisë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ try...finally ë¬¸ì„ ì‚¬ìš©í•˜ì—¬ fisë¥¼ ë°”ë¡œ í•´ì œí•´ì•¼ í•©ë‹ˆë‹¤.
>
{style="warning"}


ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒì€ íŒŒì¼ì„ ì—´ê³  ì‚¬ìš©í•œ í›„ í•´ì œí•˜ì§€ ì•Šì€ ì±„ë¡œ ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

```java
FileInputStream fis = new FileInputStream("data.txt");
loadFile(fis);
doSomethingElse();
```
```java
FileInputStream fis = null;
try {
  FileInputStream fis = new FileInputStream("data.txt");
  loadFile(fis);
} finally {
  if (fis != null) {
    try { fis.close(); }
    catch (Exception e) { logger.error(e); }
  }
}
doSomethingElse();
```

ì´ë•Œ ë°˜ë“œì‹œ finally ë¸”ë¡ ë‚´ì—ì„œ ìì›ì„ í•´ì œí•˜ì‹­ì‹œì˜¤. ê·¸ë˜ì•¼ë§Œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ì˜€ì„ ë•Œë„ ì˜¬ë°”ë¥´ê²Œ ìì›ì„ í•´ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„í•˜ë©´,
```Java
FileInputStream fis = null;
loadFile(fis);
fis.close();
doSomethingElse();
```
loadFile ë©”ì„œë“œì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒë˜ë©´ fisë¥¼ í•´ì œí•˜ëŠ” êµ¬ë¬¸ì„ ê±´ë„ˆë›°ê²Œ ë©ë‹ˆë‹¤.

ìì›ì„ ë‹´ì€ ë³€ìˆ˜ì— ìƒˆ ìì›ì„ ë‹´ì„ ë•ŒëŠ” ë¨¼ì € ê¸°ì¡´ ìì›ì„ í•´ì œí•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì€ í”„ë¡œê·¸ë¨ì€ ì–¸ëœ» ì˜ ì‘ì„±ëœ í”„ë¡œê·¸ë¨ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

```Java
FileInputStream fis = null;
try {
  fis = new FileInputStream("data1.txt"); // ...(1)
  loadFile(fis);
  fis = new FileInputStream("data2.txt"); // ...(2)
  loadFile(fis);
} finally {
  if (fis != null) {
    try { fis.close(); }
    catch (Exception e) { logger.error(e); }
  }
}
doSomethingElse();
```
í•˜ì§€ë§Œ (2)ê°€ ìˆ˜í–‰ë˜ë©´ ì´í›„ë¡œëŠ” (1)ì—ì„œ ìƒì„±í•œ ìì›ì— ì ‘ê·¼í•  ìˆ˜ê°€ ì—†ìœ¼ë¯€ë¡œ ì´ëŠ” ì˜ëª» ì‘ì„±ëœ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ê¸°ì¡´ ìì›ì„ í•´ì œí•œ í›„ì— (2)ë¥¼ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

```Java
fis = new FileInputStream("data1.txt"); // ...(1)
loadFile(fis);
fis.close();
fis = new FileInputStream("data2.txt"); // ...(2)
...
```

Java 7 ë²„ì „ ì´ìƒì„ ì§€ì›í•œë‹¤ë©´ ì§ì ‘ ìì›ì„ í•´ì œí•˜ëŠ” ê²ƒë³´ë‹¤ ë‹¤ìŒê³¼ ê°™ì´ try-with-resource ë¬¸ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ê°„í¸í•©ë‹ˆë‹¤.

```Java
try (FileInputStream fis = new FileInputStream("data.txt")) {
  loadFile(fis);
}
doSomethingElse();
```
